<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes & PDFs</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js" defer></script>
    <style>
        .container { width: 80%; margin: auto; text-align: center; }
        .dropdown { margin: 10px 0; }
        .dropdown button { width: 100%; text-align: left; cursor: pointer; padding: 10px; }
        .file-list { display: none; padding-left: 20px; list-style-type: none; }
        .file-list li { margin: 5px 0; }
        .notes-content { text-align: center; padding: 20px; }
        .viewer-container { width: 80%; height: calc(100vh - 250px); margin: 20px auto; border: 2px solid #ccc; border-radius: 10px; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2); overflow: hidden; display: none; }
        iframe, #notes-viewer { width: 100%; height: 100%; border: none; background: #fff; padding: 10px; text-align: left; overflow: auto; }
        #markdown-container { padding: 20px; background: #f5f5f5; border-radius: 5px; text-align: left; max-width: 100%; height: 100%; overflow: auto; }
    </style>
</head>
<body>
    <header class="above-header">
        <div class="container">
            <h1>Programming Notes & PDFs</h1>
            <p>Web Developer | Programmer | Designer</p>
        </div>
    </header>
    <nav class="main-menu">
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="index.html" class="current">Notes</a></li>
            <li><a href="../about/index.html">About</a></li>
        </ul>
        <button id="theme-toggle">ðŸŒ™</button>
    </nav>

    <main class="notes-content">
        <h2>Resources</h2>
        
        <!-- G-Drive PDFs -->
        <h3>G-Drive PDFs</h3>
        <div class="dropdown">
            <select id="pdf-dropdown">
                <option value="">Select a PDF</option>
            </select>
        </div>

        <!-- Notes Section -->
        <h3>Programming Notes</h3>
        <div class="dropdown">
            <select id="notes-dropdown">
                <option value="">Select a Note</option>
            </select>
        </div>

        <!-- PDF Viewer -->
        <h3 id="pdf-header" style="display: none;">PDF Viewer</h3>
        <div class="viewer-container" id="pdf-container">
            <iframe id="pdf-viewer" src=""></iframe>
        </div>

        <!-- Notes Viewer -->
        <h3 id="notes-header" style="display: none;">Notes Viewer</h3>
        <div class="viewer-container" id="notes-container">
            <div id="notes-viewer">Select a note to display content.</div>
        </div>
        <div id="markdown-container"></div>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Highlight the current menu item
            document.querySelectorAll(".main-menu a").forEach(link => {
                if (link.href === window.location.href) {
                    link.classList.add("current");
                }
            });

            // Dark mode toggle
            document.getElementById("theme-toggle").addEventListener("click", function () {
                document.body.classList.toggle("dark-mode");
            });

            // PDF Elements
            let pdfDropdown = document.getElementById("pdf-dropdown");
            let pdfViewer = document.getElementById("pdf-viewer");
            let pdfContainer = document.getElementById("pdf-container");
            let pdfHeader = document.getElementById("pdf-header");

            // Notes Elements
            let notesDropdown = document.getElementById("notes-dropdown");
            let notesViewer = document.getElementById("notes-viewer");
            let notesContainer = document.getElementById("notes-container");
            let notesHeader = document.getElementById("notes-header");

            // Load PDFs from JSON
            fetch("../notes/pdf.json")
                .then(response => response.json())
                .then(data => {
                    data.pdfs.forEach(pdf => {
                        let option = document.createElement("option");
                        option.value = pdf.link;
                        option.textContent = pdf.name;
                        pdfDropdown.appendChild(option);
                    });
                });

            // Load Notes from JSON
            fetch("../notes/notes.json")
                .then(response => response.json())
                .then(data => {
                    data.notes.forEach(note => {
                        let option = document.createElement("option");
                        option.value = note.link;
                        option.textContent = note.name;
                        notesDropdown.appendChild(option);
                    });
                });

            // PDF Selection
            pdfDropdown.addEventListener("change", function () {
                if (this.value) {
                    pdfViewer.src = this.value.replace("/view", "/preview");
                    pdfContainer.style.display = "block"; // Show PDF viewer
                    pdfHeader.style.display = "block";
                    notesContainer.style.display = "none"; // Hide Notes viewer
                    notesHeader.style.display = "none";
                    notesDropdown.value = ""; // Reset Notes dropdown
                } else {
                    pdfContainer.style.display = "none"; // Hide PDF viewer
                    pdfHeader.style.display = "none";
                }
            });

            // Notes Selection
            notesDropdown.addEventListener("change", function () {
                if (this.value) {
                    fetch(this.value)
                        .then(response => response.text())
                        .then(markdown => {
                            notesViewer.innerHTML = new showdown.Converter().makeHtml(markdown);
                            notesContainer.style.display = "block"; // Show Notes viewer
                            notesHeader.style.display = "block";
                            pdfContainer.style.display = "none"; // Hide PDF viewer
                            pdfHeader.style.display = "none";
                            pdfDropdown.value = ""; // Reset PDF dropdown
                        });
                } else {
                    notesContainer.style.display = "none"; // Hide Notes viewer
                    notesHeader.style.display = "none";
                }
            });

            // Load file list
            loadFileList();
        });

        function toggleDropdown(id) {
            const list = document.getElementById(id + "-list");
            list.style.display = (list.style.display === "block") ? "none" : "block";
        }

        async function loadFileList() {
            try {
                const response = await fetch("file-list.json");
                const data = await response.json();
                Object.keys(data).forEach(category => {
                    const list = document.getElementById(category + "-list");
                    if (list) {
                        data[category].forEach(file => {
                            const listItem = document.createElement("li");
                            const link = document.createElement("a");
                            link.href = `./${category}/${file}`;
                            link.textContent = file.replace(".md", "").replace("-", " ");
                            link.onclick = (event) => {
                                event.preventDefault();
                                loadMarkdown(`${category}/${file}`);
                            };
                            listItem.appendChild(link);
                            list.appendChild(listItem);
                        });
                    }
                });
            } catch (error) {
                console.error("Error loading file list:", error);
            }
        }

        async function loadMarkdown(file) {
            try {
                const response = await fetch(file);
                const text = await response.text();
                document.getElementById("markdown-container").innerHTML = marked.parse(text);
                hljs.highlightAll();
            } catch (error) {
                document.getElementById("markdown-container").innerHTML = "<p>Error loading file.</p>";
            }
        }
    </script>
</body>
</html>
